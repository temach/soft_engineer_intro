%!TEX TS-program = xelatex
\documentclass{beamer}

\usepackage{HSE-theme/beamerthemeHSE} % Подгружаем тему

%%% Работа с русским языком и шрифтами
\usepackage[english,russian]{babel}   % загружает пакет многоязыковой вёрстки
\usepackage{fontspec}      % подготавливает загрузку шрифтов Open Type, True Type и др.

\defaultfontfeatures{Ligatures={TeX},Renderer=Basic}  % свойства шрифтов по умолчанию
% \setmainfont[Ligatures={TeX,Historic}]{KanjiStrokeOrders.ttf} %  установите шрифты Myriad Pro или (при невозможности) замените здесь на другой шрифт, который есть в системе — например, Arial
\setmainfont[ExternalLocation={./},Ligatures={TeX,Historic}]{MyriadPro-Regular.otf} %  установите шрифты Myriad Pro или (при невозможности) замените здесь на другой шрифт, который есть в системе — например, Arial
\setsansfont[ExternalLocation={./}]{MyriadPro-Regular.otf} %  установите шрифты Myriad Pro или (при невозможности) замените здесь на другой шрифт, который есть в системе — например, Arial
\setmonofont[ExternalLocation={./}]{MyriadPro-Regular.otf}
%\setmonofont{Courier New}

\uselanguage{russian}
\languagepath{russian}
\deftranslation[to=russian]{Theorem}{Теорема}
\deftranslation[to=russian]{Definition}{Определение}
\deftranslation[to=russian]{Definitions}{Определения}
\deftranslation[to=russian]{Corollary}{Следствие}
\deftranslation[to=russian]{Fact}{Факт}
\deftranslation[to=russian]{Example}{Пример}
\deftranslation[to=russian]{Examples}{Примеры}

\usepackage{multicol} 		% Несколько колонок
\graphicspath{{images/}}  	% Папка с картинками

\usepackage{color}
\usepackage{listings}

% use this to excape underscores
\newcommand{\Code}[1]{\detokenize{#1}}

% use this to highlight in green for emphasis
\newcommand{\Green}[1]{\begin{exampleblock}#1\end{exampleblock}}

%%% Информация об авторе и выступлении
\title[Курсовая работа]{\scriptsize{%
Факультет компьютерных наук \\%
Департамент программной инженерии \\%
Курсовая работа \\%
}}

\subtitle{Программа скелетная анимация}

\author[Абрамов Артем 151 БПИ]{\scriptsize{%
Выполнил студент группы 151БПИ \\%
Абрамов Артем Михайлович \\%
Научный руководитель: \\%
доцент департамента программной \\%
инженерии, к.т.н \\%
Ахметсафина Римма Закиевна}}

%\institute[Высшая школа экономики]{Национальный исследовательский университет \\ «Высшая школа экономики» (Москва)}
\date{2016}

\begin{document}	% Начало презентации

\frame[plain]{\titlepage}	% Титульный слайд

%\section{Просто слайд с текстом}
%\subsection{Просто слайд с текстом}



%=============================================================
\begin{frame}
\frametitle{Предметная область}
\begin{multicols}{2}
\begin{small}
    3-x мерная компьютерная анимация - вид мультипликации, создаваемый при помощи компьютера. 
    \medskip
    
    В отличии от 2-х мерной анимаци, художник не рисует каждый кадр, а работает с моделью для которой последовательно задает различные позы.

    \medskip 
    Отображение анимации - одна из наиболее актуальных задач  в производственной, научной и деловой сферах, а также в области развлечений.
\end{small}

\columnbreak
    
\begin{figure}[h!]
    \centering
    \includegraphics[width=1.15\columnwidth]{blender_at_work.png}
    \caption{Создание анимации в программе Blender}
    %\label{fig:awesome_image}
\end{figure}

\end{multicols}
\end{frame}


%=============================================================
\begin{frame}
\frametitle{Основные определения}
    
\end{frame}


%=============================================================
\begin{frame}
\frametitle{Цели и задачи работы}
    Цель работы - реализовать программу, обеспечивающую просмотр анимации из файла предназначенного для неявных систем скелетной анимации.
    
    \bigskip
    
    Задачи работы
    
    \smallskip
	\begin{enumerate}
	\item Загрузка анимации из файла (содержание описанно в Т.З).
	\item Рассчет кадров анимации.
	\item Воспроизведение анимации на экране средствами OpenGL.
	\end{enumerate}
    
\end{frame}



%=============================================================
\begin{frame}
\frametitle{Различные подходы}
\begin{small}
    Для 3-х мерной анимации не существует оптимального подхода. Все системы балансируют между методами с большим количеством вычислений, и методами требующими большого объема памяти.
    
    \medskip
    \emph{Неявные системы} используются когда действия персонажа связанны с другими предметами и нельзя предугадать все возможные варианты анимации. Например, для того чтобы ставить ступню параллельно поверхности при движении по неровной земле.
    
    \smallskip
    Предпочтение явным системам отдается когда необходимо анимировать большие группы людей или животных.
    
\begin{figure}[h!]
    \centering
    \includegraphics[width=0.8\textwidth]{raw_graph_cpu_vs_ram.png}
    \caption{Шкала подходов к анимации, и отображающая позицию метода скелетной анимации}
    %\label{fig:awesome_image}
\end{figure}

\end{small}
\end{frame}



%=============================================================
\begin{frame}
\frametitle{Явные системы анимации}
\begin{scriptsize}
    Явная система - хранение отдельной модели для каждого кадра. После записи, существует много методов для воспроизведения анимации. Такие методы легко реализуются и требуют лишь элементарной математики. Однако храние моделей занимает много памяти, типичный MD3 файл с записю одного трэка анимации для одного персонажа занимает около 10MB памяти.
   
\begin{figure}[h!]
    \centering
    \includegraphics[width=1\textwidth]{explicit_animation.png}
    \caption{Каждому кадру соответствует своя модель}
\end{figure}

\end{scriptsize}
\end{frame}

  
%=============================================================
\begin{frame}
\frametitle{Неявные системы анимации}
\begin{scriptsize}
    Неявная система - хранение не моделей, а более высокоуровневого описания движения. В частности системы скелетной анимации содержат описание (в углах поворота) для каждой кости, как например локоть, плечо, шея. В реальном времени эти описания применяются к неанимированной модели для рассчета следующего кадра анимации. Эти рассчеты обычно требуют сложной математики с матрицами и тригонометрией. А следовательно и много CPU времени.
    
\begin{figure}[h!]
    \centering
    \includegraphics[width=0.8\textwidth]{implicit_animation.png}
    \caption{\scriptsize{Слева: анимированный персонаж; справа: скелет для данного кадра}}
    %\label{fig:awesome_image}
\end{figure}

\end{scriptsize}
\end{frame}



%=============================================================
\begin{frame}
\frametitle{Уже существующие решения}
    Blender, Maya, Cinema4D.
    Дорогие (кроме blender). Сложные в использовании.
    
\end{frame}


%=============================================================
\begin{frame}
\frametitle{Описание системы, общие блоки}

	Вручную упрощенная диаграмма классов и кто за что отвечает.

    Entity.cs, Animator.cs, SceneWrapper.cs, Entity.cs

\begin{figure}[h!]
    \centering
    \includegraphics[width=0.8\textwidth]{kouzminov.png}
    \caption{\scriptsize{Схема логических блоков в программе}}
   %\label{fig:awesome_image}
\end{figure}    
    
\end{frame}



%=============================================================
\begin{frame}[fragile]
\frametitle{Описание системы, блок чтения файла}
	Заполнение структур данными из файла.
	    
    \smallskip
	С помощью библиотеки Assimp производим чтение из файла. Для оптимальной работы мы переводим данные в свои структуры. Другие функции этой библиотеки не используются.
	
\begin{scriptsize}
\begin{lstlisting}
public void LoadScene(byte[] filedata)
{
    using (MemoryStream fs = new MemoryStream(filedata))
    {
        _cur_scene = new SceneWrapper(ReadAssimpScene(fs, "dae"));
        _action = new Animator(_cur_scene.Animations[0]);
        BoneNode bones = _cur_scene.BuildBoneNodes("Armature");
        Node mesh = _cur_scene.FindNode("Mesh");
        ActionState state = new ActionState();
        _enttity = new Entity(_cur_scene, mesh, bones, state);
    }
}
\end{lstlisting}
\end{scriptsize}
		
\end{frame}



%=============================================================
\begin{frame}
\frametitle{Описание системы, блок ActionState}	
	Хранит состояние анимации. Наиболее важные поля:
\begin{itemize}        
    \item Название трэка анимации.
	\item Настоящий момент времени в секундах.
	\item Индексы всех ключевых кадров и время каждого кадра.
\end{itemize}

    Есть фyнкция SetTime(\dots) для перехода к определенному моменту времени. Она находит интервал между ключевыми кадрами, подсчитывает величину интерполяции.
\end{frame}




%=============================================================
\begin{frame}[fragile]
\frametitle{Описание системы, блок SceneWrapper}
\begin{multicols}{2}
    Работает со скелетом и моделью. Реализует функции поиска костей в скелете или подмоделей в модели.
    
    \smallskip
    Функция BuildBones строит скелет по данным из модели (скелет как отдельный класс не существует, он определяеться корневой костью). 
    
    \columnbreak
    
\begin{figure}
\begin{scriptsize}
\begin{verbatim}
class BoneNode
{
    public string Name;
    public Matrix4 GlobalTransform;
    public Matrix4 LocalTransform;
    
    public BoneNode Parent;
    public List<BoneNode> Children;
    public BoneNode(Node assimp_node) { ... }
}
\end{verbatim}
\end{scriptsize}
\caption{Kласс описывающий кость скелета}
\end{figure}

\end{multicols}
\end{frame}


%=============================================================
\begin{frame}
\frametitle{Описание системы, блок Animator}
    Применяет данные описывающие (в матрицах поворота) новую позицию для каждой кости к костям из скелета. То есть деформирует скелет в соответствии с моментом времени в анимации.
    
    \medskip
    На вход блока подается класс ActionState содержащий информацию о времени и корневая кость скелета.
\end{frame}



%=============================================================
\begin{frame}
\frametitle{Описание системы, блоки DrawMesh}
	Загружает данные о модели в OpenGL.
	
    \smallskip
	Запрашивает OpenGL об отводе буферов памяти под вершины, нормали, цвета вершин и массив индексов.
    
    \smallskip
    Применяет свойства материала, например: цвет, коэффициент рассеивания света, коэффициент свечения и т.д.
    
    \smallskip
    Позволяет запросить у OpenGL указатель на созданные буфера памяти, для их модификации.
\end{frame}


%=============================================================
\begin{frame}
\frametitle{Описание системы, блок Entity}
    Объединяет компоненты необходимые для анимации одного персонажа. Хранит ссылки на скелет (корневую кость), состояние анимации (ActionState), на саму модель и на класс отрисовки модели (MeshDraw)
    
    \medskip
    В частности блок Entity применяет трансформации из скелета к вершинам модели (взвешивая действие каждой кости на вершину) и модифицирует данные в буфере данных OpenGL, что и создает эффект анимации.

\end{frame}



%=============================================================
\begin{frame}
\frametitle{Технологии и инструменты реализации}
   Библиотека \Code{Assimp v3.1 (http://assimp.org/)} для чтения файлов в формате collada (.dae).
   
   \medskip
   Библиотека \Code{OpenTK v1.1.4 (http://www.opentk.com/)} для вызова функций OpenGL из C\# и предоставления базовых классов, например: Matrix4, Vector3.
   
   \medskip 
   Язык программирования C\#

\end{frame}



%=============================================================
\begin{frame}
\frametitle{Результаты работы}
    \begin{center}            
    \begin{large}
    Демонстрация
    \end{large}
    \end{center}
\end{frame}



%=============================================================
\begin{frame}
\frametitle{Выводы по работе}
    Пути дальнейшей работы:
\begin{enumerate} 
	\item Загрузка нескольких моделей
	\item Наложение матрицы трансформации на отдельные модели
	\item Выбор из нескольких трэков анимации
	\item Нанесение текстур
	\item Изменение положения костей пользователем
\end{enumerate}

\begin{figure}[h!]
    \centering
    \includegraphics[width=0.3\textwidth]{kouzminov.png}
    \caption{\scriptsize{Схема логических блоков в программе}}
   %\label{fig:awesome_image}
\end{figure}

\end{frame}




%=============================================================
\begin{frame}
\frametitle{Список использованных источников}
    
    
\end{frame}













%=============================================================
\begin{frame}
\frametitle{Список}
\framesubtitle{Нумерованный список}
	\begin{enumerate} 
		\item Первый пункт:
		\begin{itemize}
			\item подпункт 1;
			\item подпункт 2.
		\end{itemize}
		\item Второй пункт
		\begin{enumerate}
			\item нумерованный подпункт.
		\end{enumerate} 
		\item Третий пункт
	\end{enumerate} 
\end{frame}

\begin{frame}
\frametitle{Список}
\framesubtitle{Маркированный список}
	\begin{itemize}
		\item Первый пункт:
		\begin{itemize}
			\item подпункт 1;
			\item подпункт 2.
		\end{itemize}
		\item Второй пункт
		\begin{enumerate}
			\item нумерованный подпункт.
		\end{enumerate}
		\item Третий пункт
	\end{itemize}
\end{frame}

\begin{frame}
\frametitle{Слайд с двумя колонками текста}
	\begin{multicols}{2}
			\begin{enumerate} 
		\item Первый пункт:
		\begin{itemize}
			\item подпункт 1;
			\item подпункт 2.
		\end{itemize}
		\item Второй пункт
		\begin{enumerate}
			\item нумерованный подпункт.
		\end{enumerate} 
		\item Третий пункт
	\end{enumerate} 
	\columnbreak
	\begin{itemize}
		\item Первый пункт:
		\begin{itemize}
			\item подпункт 1;
			\item подпункт 2.
		\end{itemize}
		\item Второй пункт
		\begin{enumerate}
			\item нумерованный подпункт.
		\end{enumerate}
		\item Третий пункт
	\end{itemize}
	\end{multicols}
\end{frame}

\begin{frame}
\frametitle{Слайд с картинкой}
	\begin{multicols}{2}
		\includegraphics[width=\columnwidth]{kouzminov.png}
		\columnbreak
		До 2014 года в ВШЭ было порядка 40 факультетов и отделений. Весной 2014 года начаты структурные реформы: в университете создаются «большие» факультеты («мегафакультеты»).
		\medskip 

		\textbf{\textit{Ректор}} \\ Высшей школы экономики "--- \alert{Ярослав Иванович Кузьминов}
	\end{multicols}
\end{frame}

\begin{frame}
\frametitle{Блоки}
	\begin{theorem}[Пифагора]
		Если $a$ и $b$ "--- длины катетов прямоугольного треугольника, а~$c$ "--- длина гипотенузы, то $a^2+b^2=c^2$.
	\end{theorem}

	\begin{alertblock}{Блок с красным заголовком}
		Содержимое.
	\end{alertblock}

	\begin{exampleblock}{Блок с зеленым заголовком}
		Содержимое.
	\end{exampleblock}
\end{frame}

\begin{frame}[c]
\begin{center}
\frametitle{\LARGE Спасибо за внимание!}

{\LARGE \inserttitle}

\bigskip

{\insertauthor}

\bigskip\bigskip

{\insertinstitute}

\bigskip\bigskip

{\large \insertdate}
\end{center}
\end{frame}

\end{document}
